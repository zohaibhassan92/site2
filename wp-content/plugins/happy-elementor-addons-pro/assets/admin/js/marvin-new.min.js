!function(){"use strict";function e(){return elementorCommon&&elementorCommon.helpers&&elementorCommon.helpers.getUniqueId()||elementor.helpers.getUniqueID}function t(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function n(e,n){if(!t(e,n))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var a=function(){function e(){n(this,e)}return i(e,null,[{key:"prepare",value:function(e,t,n,o){var i=_.findIndex(e,function(e){return"clipboard"===e.name}),a=_.findIndex(e,function(e){return"addNew"===e.name});return a>=0&&e[a].actions.push({name:"x-insert",title:"Add Nested Section",icon:"hm hm-happyaddons",callback:function(){r.insert(t)},isEnabled:function(){return!0}}),e.splice(i+1,0,{name:"hax-clipboard",actions:[{name:"x-copy",title:"X Copy",icon:"hm hm-happyaddons",shortcut:o,callback:function(){n.copy(t)}},{name:"x-copy-all",title:"X Copy All",icon:"hm hm-happyaddons",shortcut:"Content",callback:function(){n.copyAll()}},{name:"x-paste",title:"X Paste",icon:"hm hm-happyaddons",shortcut:"Live Paste",callback:function(){n.paste(t)}}]}),e}},{key:"prepareForBlankColumn",value:function(e,t,n){return e.push({name:"hax-clipboard",actions:[{name:"x-copy-all",title:"X Copy All",icon:"hm hm-happyaddons",shortcut:"Content",callback:function(){n.copyAll()}},{name:"x-paste",title:"X Paste",icon:"hm hm-happyaddons",shortcut:"Live Paste",callback:function(){n.paste(t)}}]}),e}}]),e}(),r=function(){function t(){n(this,t)}return i(t,null,[{key:"insert",value:function(t){var n=t.getContainer().view;"column"===n.getElementType()&&n.addElement({elType:"section",isInner:!0,settings:{},elements:[{id:e(),elType:"column",isInner:!0,settings:{_column_size:100},elements:[]}]})}}]),t}(),s=function(){function e(t,o){n(this,e),this.widgetType=t,this.widgetCode=o}return i(e,[{key:"getWidgetType",value:function(){return this.widgetType}},{key:"getWidgetCode",value:function(){return this.widgetCode}},{key:"toJSON",value:function(){return{widgetType:this.widgetType,widgetCode:this.widgetCode}}}]),e}(),l=function(){function e(t){n(this,e),this.widgetStorage=t,this.lastCopiedElement="",this.lastPastedElementModel={}}return i(e,[{key:"copy",value:function(e){var t=new s(e.model.get("widgetType"),e.model.toJSON());this.widgetStorage.save(t)}},{key:"copyAll",value:function(){var e=Object.values(elementor.getPreviewView().children._views).map(function(e){return e.getContainer()}),t=e.map(function(e){return e.model.toJSON()}),n=new s("page",t);this.widgetStorage.save(n)}},{key:"paste",value:function(e){var t=this;this.widgetStorage.fetch(function(n){if("page"===n.widgetType&&n.widgetCode&&n.widgetCode.length>0){var o=elementor.$previewContents.find("html");return void jQuery.ajax({url:marvin.ajaxURL,method:"POST",data:{type:"import",action:"ha_process_ixport",nonce:marvin.nonce,content:JSON.stringify(n.widgetCode)},beforeSend:function(){o.addClass("ha-ixport").attr("data-ixport-text","Processing...")}}).done(function(e){if(e.success){var t=e.data[0],n=elementor.getPreviewContainer(),i={};i.at=n.view.collection.length,t.forEach(function(e){$e.run("document/elements/create",{container:n,model:e,options:i}),i.at++}),o.attr("data-ixport-text","Processing completed");var a=setTimeout(function(){o.removeClass("ha-ixport"),clearTimeout(a)},60)}})}var i=n.widgetCode,a=JSON.stringify(i),r=/\.(gif|jpg|jpeg|svg|png)/gi.test(a),s=e.model.get("elType"),l=i.elType,c={elType:l,settings:i.settings},u=null,d={at:0};if("section"===l){var p=null;"widget"===s?p=e.getContainer().parent.parent:"column"===s?p=e.getContainer().parent:"section"===s&&(p=e.getContainer()),c.elements=i.elements,u=p.parent,d.at=p.view.getOption("_index")+1,p.model.get("isInner")&&(c.isInner=!0)}else"column"===l?(c.elements=i.elements,"widget"===s?(u=e.getContainer().parent.parent,d.at=e.getContainer().parent.view.getOption("_index")+1):"column"===s?(u=e.getContainer().parent,d.at=e.getOption("_index")+1):"section"===s&&(u=e.getContainer())):"widget"===l&&(c.widgetType=i.widgetType,u=e.getContainer(),"widget"===s?(u=e.getContainer().parent,d.at=e.getOption("_index")+1):"column"===s?u=e.getContainer():"section"===s&&(u=e.children.findByIndex(0).getContainer()));if(r&&!_.isEmpty(t.lastPastedElementModel)&&t.lastCopiedElement===a)return d.clone=!0,void $e.run("document/elements/create",{model:t.lastPastedElementModel,container:u,options:d});var m=$e.run("document/elements/create",{model:c,container:u,options:d});r&&jQuery.ajax({url:marvin.ajaxURL,method:"POST",data:{type:"import",action:"ha_process_ixport",nonce:marvin.nonce,content:a},beforeSend:function(){m.view.$el.addClass("ha-ixport").attr("data-ixport-text","Processing...")}}).done(function(e){if(e.success){var n=e.data[0];c.settings=n.settings,c.elType=n.elType,"widget"===n.elType?c.widgetType=n.widgetType:c.elements=n.elements,m.view.$el.attr("data-ixport-text","Processing completed");var o=setTimeout(function(){$e.run("document/elements/delete",{container:m});var e=$e.run("document/elements/create",{model:c,container:u,options:d});t.lastPastedElementModel=elementorCommon.helpers.cloneObject(e.model.toJSON()),clearTimeout(o)},750)}}),t.lastCopiedElement=a})}}]),e}(),c=function(){function e(t){n(this,e),this.storageKey=t,xdLocalStorage.init({iframeUrl:"https://happyaddons.com/marvin/index.html",initCallback:function(){}})}return i(e,[{key:"save",value:function(e){xdLocalStorage.setItem(this.storageKey,JSON.stringify(e))}},{key:"fetch",value:function(e){return xdLocalStorage.getItem(this.storageKey,function(t){var n=JSON.parse(t.value),o=new s(n.widgetType,n.widgetCode);e(o)})}}]),e}(),u=function(){function e(t,o,i){n(this,e),this.storageKey=t,this.storageEndpoint=o,this.$=i}return i(e,[{key:"save",value:function(e){this.$.post(this.storageEndpoint,{key:this.storageKey,data:JSON.stringify(e)})}},{key:"fetch",value:function(e){this.$.get(this.storageEndpoint,{key:this.storageKey},function(t){var n=JSON.parse(t),o=new s(n.widgetType,n.widgetCode);e(o)})}}]),e}();window.HWidgetStorage=c,window.HSWidgetStorage=u,window.HClipBoard=l,window.HWidget=s;var d=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),p=elementor.hooks.addFilter,m=d?new u(marvin.storageKey,"https://happymonster.dev/storage/safari.php",$):new c(marvin.storageKey),g=new l(m);p("elements/widget/contextMenuGroups",function(e,t){return a.prepare(e,t,g,"Widget")}),p("elements/section/contextMenuGroups",function(e,t){return a.prepare(e,t,g,"Section")}),p("elements/column/contextMenuGroups",function(e,t){return a.prepare(e,t,g,"Column")}),p("element/view",function(e,t){var n;return"column"===t.get("elType")?e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),n=this},emptyView:e.prototype.emptyView.extend({getContextMenuGroups:function(){var t=e.prototype.emptyView.prototype.getContextMenuGroups.apply(this,arguments);return a.prepareForBlankColumn(t,n,g)}})}):e})}();