!function(e){function t(e){return"widget"===e.get("elType")&&"ha-hotspots"===e.get("widgetType")}window.haHasIconLibrary=function(){return elementor.helpers&&elementor.helpers.renderIcon},window.haGetFeatureLabel=function(e){var t=document.createElement("DIV");return t.innerHTML=e,e=t.textContent||t.innerText||e,e.length>20?e.substring(0,20)+"...":e},window.haGetTranslated=function(e,t){return elementorCommon.translate(e,null,t,HappyAddonsEditor.i18n)};var n=function(e){return{initialize:function(){e.prototype.initialize.apply(this,arguments),this.updateContextMenu(),this.addedByContextMenuData=null,this.listenTo(elementor.channels.dataEditMode,"switch",this.toggleSpotDragMode),this.listenTo(this.model.get("editSettings"),"change:activeItemIndex",this.onEditSettingsChange),this.listenTo(this.model.get("settings").get("spots"),"add",this.handleAddedByContextMenu)},handleAddedByContextMenu:function(e){var t=elementorFrontend.getCurrentDeviceMode(),n="desktop"===t?"":"_"+t,o=e,i={},a=this.$el.width(),r=this.$el.height(),s=this.addedByContextMenuData&&this.addedByContextMenuData.offsetX,d=this.addedByContextMenuData&&this.addedByContextMenuData.offsetY,l=o.get("x_pos"+n).unit,u=o.get("y_pos"+n).unit;_.isNull(this.addedByContextMenuData)||(s=(100*s/a).toFixed(2),d=(100*d/r).toFixed(2),i["x_pos"+n]={size:s,unit:l},i["y_pos"+n]={size:d,unit:u},o.setExternalChange(i),this.renderStyles(),this.addedByContextMenuData=null)},updateContextMenu:function(){var e=this.getBehavior("contextMenu"),t=e.getOption("groups"),n=_.findWhere(t,function(e){return"general"===e.name}),o=_.findIndex(n.actions,function(e){return"ha-add-hotspot"===e.name}),i=this;-1===o&&n.actions.push({name:"ha-add-hotspot",title:"Add Hotspot",icon:"hm hm-happyaddons",callback:function(){i.model.trigger("request:edit"),i.getSpotsView().onButtonAddRowClick()}}),e.options.groups=t,e.initContextMenu()},onEditSettingsChange:function(e){this.$el.find('[data-index="'+(e.get("activeItemIndex")-1)+'"]').addClass("ha-hotspots__item--focus").siblings(".ha-hotspots__item--focus").removeClass("ha-hotspots__item--focus")},getControlViewByName:function(e){return elementor.getPanelView().getCurrentPageView().children.find(function(t){return t.model.get("name")===e})},getSpotsView:function(){return $e.routes.isPartOf("panel/editor/content")||$e.route("panel/editor/content",{model:this.getContainer().model,view:this.getContainer().view}),"_section_spots"!==this.model.get("editSettings").get("panel").activeSection&&this.getControlViewByName("_section_spots").ui.heading.click(),this.getControlViewByName("spots")},getSpotByIndex:function(e){return this.getSpotsView().children.findByIndex(e)},onRender:function(){e.prototype.onRender.call(this);var t=this;_.defer(function(){t.toggleSpotDragMode()})},onDestroy:function(){this.deactivateSpotDragMode(),e.prototype.onDestroy.call(this)},ui:function(){var t=e.__super__.ui.call(this);return t.spotHandle="> .elementor-widget-container .ha-hotspots__item",t},events:function(){var t=e.__super__.events.call(this);return t.contextmenu="onContextMenuOpen",t["click @ui.spotHandle"]="onClickSpot",t["dragstart @ui.spotHandle"]="openSelectedSpot",t["dragstop @ui.spotHandle"]="onDragSpotHandle",t},onContextMenuOpen:function(e){e.stopPropagation(),this.addedByContextMenuData=e},onClickSpot:function(e){e.preventDefault(),this.openSelectedSpot(e)},openSelectedSpot:function(e){e.stopPropagation(),this.model.trigger("request:edit");var t=this.getSpotByIndex(e.currentTarget.getAttribute("data-index")),n=t.ui.itemTitle;n.parent().next().hasClass("editable")||n.click()},onDragSpotHandle:function(e,t){e.stopPropagation();var n=elementorFrontend.getCurrentDeviceMode(),o="desktop"===n?"":"_"+n,i=this.getEditModel(),a=i.getSetting("spots"),r=t.helper,s=r.data("index"),d=a.at(s),l={},u=elementorFrontend.config.is_rtl,c=r.offsetParent().width(),p=r.offsetParent().height(),h=r.outerWidth(!0),g=t.position.left,f=c-g-h,m=u?f:g,v=t.position.top,y=d.get("x_pos"+o).unit,C=d.get("y_pos"+o).unit;m=(100*m/c).toFixed(2),v=(100*v/p).toFixed(2),l["x_pos"+o]={size:m,unit:y},l["y_pos"+o]={size:v,unit:C},d.setExternalChange(l),this.renderStyles();var w=setTimeout(function(){r.css({top:"",left:"",right:"",bottom:"",width:"",height:""}),clearTimeout(w)},250)},activateSpotDragMode:function(){this.ui.spotHandle.draggable({addClasses:!1})},deactivateSpotDragMode:function(){this.ui.spotHandle.draggable("instance")&&this.ui.spotHandle.draggable("destroy")},toggleSpotDragMode:function(){var e="edit"===elementor.channels.dataEditMode.request("activeMode");this.deactivateSpotDragMode(),e&&elementor.userCan("design")&&this.activateSpotDragMode()}}};elementor.hooks.addFilter("element/view",function(e,o){return t(o)?e.extend(n(e)):e}),(new function(){var t=this;this.model=elementor.settings.general.model,t.renderStyleTab=function(){elementor.channels.editor.on("happy:live_copy:style",function(){$e.route("panel/general-settings/style");var e=elementor.getPanelView().currentPageView;e.activateSection("_ha_live_copy_button_style"),e.render()})},t.onButtonPreviewChange=function(){t.model.on("change:ha_live_copy_preview",function(e,n){"yes"===n?t.addButton():t.removeButton()})},t.getPreviewDoc=function(){return elementor.$previewContents&&elementor.$previewContents.length?elementor.$previewContents:e()},t.getSections=function(){var n=t.getPreviewDoc().find(".elementor-section-wrap > .elementor-section");return n.length?n:e()},t.getClonedButton=function(){if(t.$clonedButton)return t.$clonedButton;var e=t.getPreviewDoc().find("#ha-live-copy-base");return t.$clonedButton=e.length?e.clone().removeAttr("id").removeAttr("style"):null,t.$clonedButton},t.addButton=function(){t.getSections().addClass("live-copy-preview").append(t.getClonedButton())},t.removeButton=function(){t.getSections().removeClass("live-copy-preview").find(".ha-live-copy-wrap").remove()},t.onPreviewLoad=function(){elementor.$preview.on("load",function(){t.removeButton(),t.renderStyleTab(),t.onButtonPreviewChange()})},t.initialize=function(){t.onPreviewLoad()}}).initialize()}(jQuery);