!function(e,t){"use strict";var n=t.modules,i=n.controls.Select.extend({isSurpriseControl:function(){return"_ha_design"===this.model.get("name")&&-1!==this.getWidgetName().indexOf("ha-")},onReady:function(){window.happyDesigns=window.happyDesigns||{},this.fetchSurprises()},onRender:function(){this.constructor.__super__.onRender.apply(this,arguments),this.isSurpriseControl()&&this.addResetButton()},onResetClick:function(){var e=t.getPanelView().getCurrentPageView().getOption("editedElementView");$e.run("document/elements/reset-style",{container:e.getContainer()})},addResetButton:function(){var e=this;this.ui.select.before('<i title="Reset Style" class="eicon-redo ha-reset-design ha-reset-design--disable" aria-hidden="true"></i>'),this.$el.find(".ha-reset-design").on("click",function(){e.onResetClick(),e.ui.select.val(""),e.setSettingsModel("")})},getElementSettingsModel:function(){return this.container.settings},getWidgetName:function(){return this.getElementSettingsModel().get("widgetType")},isFetched:function(){return!_.isUndefined(window.happyDesigns[this.getWidgetName()])},fetchSurprises:function(){var t=this;this.isSurpriseControl()&&!this.isFetched()&&this.getWidgetName()&&e.get(hapro.ajaxUrl,{action:"ha_make_me_surprised",widget:this.getWidgetName(),secret:hapro.secret}).done(function(e){e.success&&t.setSurprises(e.data)})},setSurprises:function(e){window.happyDesigns[this.getWidgetName()]=JSON.parse(e)},getSurprises:function(){return _.isUndefined(window.happyDesigns)?{}:window.happyDesigns[this.getWidgetName()]||{}},onBaseInputChange:function(e){if(this.constructor.__super__.onBaseInputChange.apply(this,arguments),this.isSurpriseControl()&&e.currentTarget.value){e.stopPropagation();var t=this.getSurprises();_.isUndefined(t[e.currentTarget.value])||this.applySurprise(t[e.currentTarget.value])}},applySurprise:function(e){var t=this.getElementSettingsModel().controls,n=this,i={};_.each(t,function(t,s){if(n.model.get("name")!==s&&!_.isUndefined(e[s])){if(t.is_repeater){var r=n.getElementSettingsModel().get(s).clone();r.each(function(t,i){_.isUndefined(e[s][i])||_.each(t.controls,function(t,o){n.isStyleTransferControl(t)&&r.at(i).set(o,e[s][i][o])})}),i[s]=r}n.isStyleTransferControl(t)&&(i[s]=e[s])}}),this.getElementSettingsModel().setExternalChange(i),this.container.view.render()},isStyleTransferControl:function(e){return!_.isUndefined(e.style_transfer)&&e.style_transfer?e.style_transfer:"content"!==e.tab||e.selectors||e.prefix_class}});t.addControlView("select",i)}(window.jQuery,window.elementor);